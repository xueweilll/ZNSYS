<!doctype html>
<html>
    <head>
        
        <title>jsPlumb 1.6.2 demo - yui</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <link rel="stylesheet" href="jsPlumb/jsplumb.css">     
        <link rel="stylesheet" href="jsPlumb/demo.css">
		<link rel="stylesheet" href="jquery-easyui-1.3.2/themes/default/easyui.css">
		<link rel="stylesheet" type="text/css" href="jquery-easyui-1.3.2/themes/icon.css">
		<script type="text/javascript" src="jquery-easyui-1.3.2/jquery-1.8.0.min.js"></script>
		<script type="text/javascript" src="jquery-easyui-1.3.2/jquery.easyui.min.js"></script>
		<script>
		    $(function () {
		        var d = ['{"total":1,"rows":[{"p":"2013-05-09","a":"张三","w":"2013-06-22"}]}',
                            '{"total":1,"rows":[{"p":"2013-05-09","a":"a2","w":"w2"}]}',
                           ' {"total":1,"rows":[{"p":"2013-05-09","a":"a3","w":"w3"}]}',
                            '{"total":1,"rows":[{"p":"2013-05-09","a":"a4","w":"w4"}]}'];
		         $('#mywin').panel({
		           
                    closable:true,
                    title: 'My Panel',
		        });
                 $('#mywin').panel('close');
		        grid = $('#grid').datagrid({
		            title: '生产过程数据',
		            fit: true,
		            nowrap: false,
		            rownumbers: true,
		            striped: true,
		            columns: [[
				    { title: '样品批号', field: 'p', width: 120, align: 'center' },
				    { title: '检测人', field: 'a', width: 130, align: 'center' },
				    { title: '时间 ', field: 'w', width: 450, align: 'left' }
           
				]],
		            singleSelect: true,
		            rownumbers: true,
		            pagination: true,
		            fitColumns: true,
		            onLoadError: function () {
		                //showLoadError();
		            }
		        });
		        $(".window").bind("click", function () {
		            var id = this.id;
		            var color = $(this).attr("style");
		           // alert(color);
		            if (color != "color: green;" && color != "color:green;") {
		                alert("该实验未完成！");
		            } else {
		                id = id.replace("flowchartWindow", "");
		                if (id == '1') {
		                    grid = $('#grid').datagrid({
		                        title: '生产过程数据',
		                        fit: true,
		                        nowrap: false,
		                        rownumbers: true,
		                        striped: true,
		                        columns: [[
				    { title: '样品批号', field: 'p', width: 120, align: 'center' },
				    { title: '检测人', field: 'a', width: 130, align: 'center' },
				    { title: '时间', field: 'w', width: 450, align: 'left' }
				]],
		                        singleSelect: true,
		                        rownumbers: true,
		                        pagination: true,
		                        fitColumns: true,
		                        toolbar: [
		                         {
		                            text: '查看具体信息',
		                            iconCls: 'icon-search',
		                            handler: search1
		                        }],
		                        onLoadError: function () {
		                            //showLoadError();
		                        }
		                    });
		                }
		                if (id == '2') {
		                    $("#grid").empty();
		                    grid = $('#grid').datagrid({
		                        title: '岗位接样数据',
		                        fit: true,
		                        nowrap: false,
		                        rownumbers: true,
		                        striped: true,
		                        columns: [[
				                 { title: '测试2', field: 'p', width: 120, align: 'center' },
				                 { title: '地区2', field: 'a', width: 130, align: 'center' },
				                 { title: '井号2', field: 'w', width: 450, align: 'left' }
				            ]],
		                        singleSelect: true,
		                        rownumbers: true,
		                        pagination: true,
		                        fitColumns: true,
		                        onLoadError: function () {
		                            //showLoadError();
		                        }
		                    });
		                }
		                if (id == '3') {
		                    grid = $('#grid').datagrid({
		                        title: '岗位分析数据',
		                        fit: true,
		                        nowrap: false,
		                        rownumbers: true,
		                        striped: true,
		                        columns: [[
				                 { title: '测试3', field: 'p', width: 120, align: 'center' },
				                 { title: '地区3', field: 'a', width: 130, align: 'center' },
				                 { title: '井号3', field: 'w', width: 450, align: 'left' }
				            ]],
		                        singleSelect: true,
		                        rownumbers: true,
		                        pagination: true,
		                        fitColumns: true,
		                        onLoadError: function () {
		                            //showLoadError();
		                        }
		                    });
		                }
		                if (id == '4') {
		                    grid = $('#grid').datagrid({
		                        title: '报告审批数据',
		                        fit: true,
		                        nowrap: false,
		                        rownumbers: true,
		                        striped: true,
		                        columns: [[
				                 { title: '测试4', field: 'p', width: 120, align: 'center' },
				                 { title: '地区4', field: 'a', width: 130, align: 'center' },
				                 { title: '井号4', field: 'w', width: 450, align: 'left' }
				            ]],
		                        singleSelect: true,
		                        rownumbers: true,
		                        pagination: true,
		                        fitColumns: true,
		                        onLoadError: function () {
		                            //showLoadError();
		                        }
		                    });
		                }
		                $('#grid').datagrid("loadData", $.parseJSON(d[id - 1]));
		            }
		        });
		    });

		    var tmp = 4;
		    var pro = 0;
		    function adddiv() {
                var addname = $("#addname").val();
                $("#end").before("<div class='window' id='flowchartWindow" + (++tmp) + "'><strong>" + addname + "</strong><br/><br/></div>");
			    $("#"+addname).draggable({
			});
			//jsPlumb.addEndpoints(addname, ["BottomCenter"], ["TopCenter"]);
			//jsPlumb.repaintEverything();
			$("#addname").val("");

}
function process() {
    if (pro <= tmp) {
        $("#flowchartWindow" + (pro + 1)).attr("style", "color:green;");
        pro++;
    }
}
function search1() {
    var d = '{"p":"2013-05-09","a":"玛湖","w":"玛18","s":3067,"c":"a","y":"a","f":"是","sw":"否","gsw":"否","yqs":"否","date":"2013-05-09","dw":"勘探公司西北缘项目部","wtr":"付连明","me o":"test","qr":"2014-7-11"}';
    var da = $.parseJSON(d);
    $("#mydata").datagrid({
        title: '送样具体信息',
        fit: true,
        nowrap: false,
        rownumbers: true,
        striped: true,
        columns: [[
				                 { title: '样品批号', field: 'p', width: 120, align: 'center' },
				                 { title: '地区', field: 'a', width: 130, align: 'center' },
				                 { title: '井号', field: 'w', width: 450, align: 'left' },
                                   { title: '样品深度', field: 's', width: 120, align: 'center' },
				                 { title: '层次', field: 'c', width: 130, align: 'center' },
				                 { title: '岩石定名', field: 'y', width: 450, align: 'left' },
                                   { title: '岩石物性分析', field: 'f', width: 120, align: 'center' },
				                 { title: '生物分析', field: 'sw', width: 130, align: 'center' },
				                 { title: '古生物分析', field: 'gsw', width: 450, align: 'left' },
                                   { title: '油气水分析', field: 'yqs', width: 130, align: 'center' },
				                 { title: '送样日期', field: 'date', width: 450, align: 'left' },
                                   { title: '委托单位', field:'dw', width: 130, align: 'center' },
				                 { title: '委托人', field: 'wtr', width: 450, align: 'left' },
                                   { title: '备注', field: 'memo', width: 130, align: 'center' },
				                 { title: '取样日期', field: 'qr', width: 450, align: 'left' },
				            ]],
        singleSelect: true,
        rownumbers: true,
        fitColumns: true,
        onLoadError: function () {
            //showLoadError();
        }
    });
    $('#gmydata').datagrid("loadData",da);
    $("#mywin").panel('open');
}
		</script>
    </head>
    <body data-demo-id="flowchart" data-library="yui">
        
        <div id="main">
            <!-- demo -->
            <div>
			<input type="text" style="border-radius:5px;box-shadow:1px 1px 1px rgba(0,0,0,0.3);" id="addname">&nbsp;&nbsp;<a href="#" class="easyui-linkbutton" onclick="adddiv();"/>添加一个生产过程</a>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#" class="easyui-linkbutton" onclick="process();"/>进度跟进</a></div>
            <div class="demo flowchart-demo" id="flowchart" style="width:50%;float:left;">
                <div class="window" id="flowchartWindow1"><strong>调度送样</strong><br/><br/></div>
                <div class="window" id="flowchartWindow2"><strong>岗位接样</strong><br/><br/></div>
                <div class="window" id="flowchartWindow3"><strong>岗位分析</strong><br/><br/></div>
                <div class="window" id="flowchartWindow4"><strong>报告审批</strong><br/><br/></div> 
				<div id="end" style="display:none"></div>
            </div>
            <div class="frame" id="frame">
                <table id="grid"></table>
            </div>
            <div style="width:600px;height:500px; position:absolute;left:200px;top:100px; z-index:2000" >
                    <div id="mywin" style="width:600px;height:500px" >
                    <table id="mydata"></table>
                    </div>
            </div>
            
            <!-- /demo -->
        </div>
        <script src="jsPlumb/yui-min.js"></script>
		
		<!-- 添加触屏操作 -->
		<script src="jsPlumb/jquery.ui.touch-punch.min.js"></script>
                
        <!-- JS -->
        <!-- support lib for bezier stuff -->
        <script src="jsPlumb/jsBezier-0.6.js"></script>     
        <!-- geom functions -->   
        <script src="jsPlumb/biltong-0.2.js"></script>
        <!-- jsplumb util -->
        <script src="jsPlumb/util.js"></script>
        <!-- base DOM adapter -->
        <script src="jsPlumb/dom-adapter.js"></script>        
        <!-- main jsplumb engine -->
        <script src="jsPlumb/jsPlumb.js"></script>
        <!-- endpoint -->
        <script src="jsPlumb/endpoint.js"></script>                
        <!-- connection -->
        <script src="jsPlumb/connection.js"></script>
        <!-- anchors -->
        <script src="jsPlumb/anchors.js"></script>        
        <!-- connectors, endpoint and overlays  -->
        <script src="jsPlumb/defaults.js"></script>
        <!-- bezier connectors -->
        <script src="jsPlumb/connectors-bezier.js"></script>
        <!-- state machine connectors -->
        <script src="jsPlumb/connectors-statemachine.js"></script>
        <!-- flowchart connectors -->
        <script src="jsPlumb/connectors-flowchart.js"></script>
        <script src="jsPlumb/connector-editors.js"></script>
        <!-- SVG renderer -->
        <script src="jsPlumb/renderers-svg.js"></script>
        
        
        <!-- vml renderer -->
        <script src="jsPlumb/renderers-vml.js"></script>
        
        <!-- yui jsPlumb adapter -->
        <script src="jsPlumb/yui.jsPlumb.js"></script>
        <!-- /JS -->
        
        <!--  demo code -->
        <script src="jsPlumb/demo.js"></script>    
        
    </body>
</html>